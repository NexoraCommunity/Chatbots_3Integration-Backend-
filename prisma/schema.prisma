// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String                     @id @default(uuid())
  firstName                String                     @db.VarChar(50)
  lastName                 String?                    @db.VarChar(50)
  email                    String                     @unique @db.VarChar(100)
  password                 String?                    @db.VarChar(100)
  picture                  String?                    @db.VarChar(100)
  role                     String?                    @default("user")
  prompt                   Prompt[]
  bot                      Bot[]
  authProvider             Account[]
  userOtp                  UserOtp[]
  product                  Product[]
  category                 Category[]
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  WhatsaapBussinessAccount WhatsaapBussinessAccount[]

  @@map("User")
}

model Account {
  id                Int      @id @default(autoincrement())
  userId            String   @default(uuid())
  provider          String   @db.VarChar(50)
  providerAccountId String   @db.VarChar(100)
  accessToken       String?  @db.VarChar(255)
  refreshToken      String?  @db.VarChar(255)
  expires_at        Int?
  token_type        String?
  scope             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("Account")
}

model WhatsappSession {
  id        String   @id
  data      String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("WhatsappSession")
}

model WhatsappKeys {
  id        String
  type      String
  value     String   @db.LongText
  sessionId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([sessionId, id, type])
  @@map("WhatsappKeys")
}

model WhatsaapBussinessAccount {
  id          String        @id @default(uuid())
  accessToken String        @db.VarChar(255)
  userId      String        @default(uuid())
  facebookId  String        @default(uuid())
  displayName String        @db.VarChar(100)
  email       String?       @db.VarChar(100)
  businessId  String        @db.VarChar(255)
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  numberPhone NumberPhone[]

  @@map("WhatsaapBussinessAccount")
}

model NumberPhone {
  id                         String                   @id @default(uuid())
  numberPhoneId              String
  whatsaapBussinessAccountId String                   @default(uuid())
  WhatsaapBussinessAccount   WhatsaapBussinessAccount @relation(fields: [whatsaapBussinessAccountId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("NumberPhone")
}

model UserOtp {
  id        Int      @id @default(autoincrement())
  userId    String   @default(uuid())
  otpCode   String   @db.VarChar(10)
  isUsed    Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("UserOTP")
}

model Prompt {
  id        String   @id @default(uuid())
  userId    String   @default(uuid())
  name      String   @db.VarChar(100)
  prompt    String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User  @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bot  Bot[]

  @@map("Prompt")
}

model Bot {
  id        String   @id @default(uuid())
  userId    String   @default(uuid())
  promptId  String   @default(uuid())
  bot_name  String   @db.VarChar(100)
  is_active Boolean? @default(false)
  type      String   @db.VarChar(50)
  dataType  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  prompt       Prompt         @relation(fields: [promptId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conversation Conversation[]

  @@map("BOT")
}

model Conversation {
  id        String    @id @default(uuid())
  botId     String    @default(uuid())
  room      String?   @db.VarChar(100)
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  bot Bot @relation(fields: [botId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("Conversation")
}

model Message {
  id             String   @id @default(uuid())
  conversationId String   @default(uuid())
  message        String
  type           String?  @db.VarChar(50)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("Message")
}

model Product {
  id          String    @id @default(uuid())
  userId      String    @default(uuid())
  name        String    @db.VarChar(100)
  description String    @db.VarChar(500)
  price       Float     @db.Float()
  stock       Int
  weight      Float     @db.Float()
  image       String    @db.VarChar(225)
  variant     Variant[]
  sku         String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("Product")
}

model Category {
  id        String   @id @default(uuid())
  userId    String   @default(uuid())
  name      String   @db.VarChar(100)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("Category")
}

model Variant {
  id              String   @id @default(uuid())
  productId       String   @default(uuid())
  name            String   @db.VarChar(100)
  value           String   @db.VarChar(100)
  image           String
  priceAdjustment Float    @db.Float()
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("Variant")
}
