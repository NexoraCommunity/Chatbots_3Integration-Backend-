// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String                     @id @default(uuid())
  firstName                String                     @db.VarChar(50)
  lastName                 String?                    @db.VarChar(50)
  email                    String                     @unique @db.VarChar(100)
  password                 String?                    @db.VarChar(100)
  picture                  String?                    @db.VarChar(100)
  role                     String?                    @default("user")
  prompt                   Prompt[]
  bot                      Bot[]
  authProvider             Account[]
  userOtp                  UserOtp[]
  product                  Product[]
  category                 Category[]
  userSubcription          UserSubcribtion[]
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  WhatsaapBussinessAccount WhatsaapBussinessAccount[]

  @@map("User")
}

model Account {
  id                Int      @id @default(autoincrement())
  userId            String   @default(uuid())
  provider          String   @db.VarChar(50)
  providerAccountId String   @db.VarChar(100)
  accessToken       String?  @db.VarChar(255)
  refreshToken      String?  @db.VarChar(255)
  expires_at        Int?
  token_type        String?
  scope             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onUpdate: Cascade)

  @@map("Account")
}

model UserSubcribtion {
  id        String   @id @default(uuid())
  userId    String   @default(uuid())
  startDate DateTime
  endDate   DateTime
  user      User     @relation(fields: [userId], references: [id], onUpdate: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("UserSubcribtion")
}

model Subscribtion {
  id           Int       @id @default(autoincrement())
  name         String
  price        Float     @db.Float()
  durationDays String
  feature      Feature[]

  @@map("Subcribtion")
}

model Feature {
  id            Int    @id @default(autoincrement())
  featureName   String @db.VarChar(255)
  subcribtionId Int

  subcribtion Subscribtion @relation(fields: [subcribtionId], references: [id], onUpdate: Cascade)
}

model WhatsappSession {
  id        String   @id
  data      String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("WhatsappSession")
}

model WhatsappKeys {
  id        String
  type      String
  value     String   @db.LongText
  sessionId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([sessionId, id, type])
  @@map("WhatsappKeys")
}

model WhatsaapBussinessAccount {
  id          String        @id @default(uuid())
  accessToken String        @db.VarChar(255)
  userId      String        @default(uuid())
  facebookId  String        @default(uuid())
  displayName String        @db.VarChar(100)
  email       String?       @db.VarChar(100)
  businessId  String        @db.VarChar(255)
  user        User          @relation(fields: [userId], references: [id], onUpdate: Cascade)
  numberPhone NumberPhone[]

  @@map("WhatsaapBussinessAccount")
}

model NumberPhone {
  id                         String                   @id @default(uuid())
  numberPhoneId              String
  whatsaapBussinessAccountId String                   @default(uuid())
  WhatsaapBussinessAccount   WhatsaapBussinessAccount @relation(fields: [whatsaapBussinessAccountId], references: [id], onUpdate: Cascade)

  @@map("NumberPhone")
}

model UserOtp {
  id        Int      @id @default(autoincrement())
  userId    String   @default(uuid())
  otpCode   String   @db.VarChar(10)
  isUsed    Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onUpdate: Cascade)

  @@map("UserOTP")
}

model Prompt {
  id        String   @id @default(uuid())
  userId    String   @default(uuid())
  name      String   @db.VarChar(100)
  prompt    String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User  @relation(fields: [userId], references: [id], onUpdate: Cascade)
  bot  Bot[]

  @@map("Prompt")
}

model Bot {
  id              String   @id @default(uuid())
  userId          String   @default(uuid())
  promptId        String   @default(uuid())
  bot_name        String   @db.VarChar(100)
  is_active       Boolean? @default(false)
  type            String   @db.VarChar(50)
  data            String?  @db.VarChar(700)
  llm             String   @db.VarChar(100)
  model           String   @db.VarChar(100)
  numberPhoneWaba String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user         User           @relation(fields: [userId], references: [id], onUpdate: Cascade)
  prompt       Prompt         @relation(fields: [promptId], references: [id], onUpdate: Cascade)
  order        Order[]
  conversation Conversation[]

  @@map("BOT")
}

model Conversation {
  id              String    @id @default(uuid())
  botId           String    @default(uuid())
  room            String    @db.VarChar(100)
  integrationType String    @db.VarChar(100)
  messages        Message[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  bot Bot @relation(fields: [botId], references: [id], onUpdate: Cascade)

  @@map("Conversation")
}

model Message {
  id             String   @id @default(uuid())
  conversationId String   @default(uuid())
  message        String
  type           String   @db.VarChar(100)
  role           String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  conversation Conversation @relation(fields: [conversationId], references: [id], onUpdate: Cascade)

  @@map("Message")
}

model Product {
  id          String   @id @default(uuid())
  userId      String   @default(uuid())
  categoryId  String   @default(uuid())
  name        String   @db.VarChar(100)
  description String   @db.VarChar(1000)
  price       Float    @db.Float()
  stock       Int
  weight      Float?   @db.Float()
  image       String   @db.VarChar(500)
  sku         String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  variantOptions  VariantOption[]
  productVariants ProductVariant[]
  orderItem       OrderItem[]

  user     User     @relation(fields: [userId], references: [id], onUpdate: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onUpdate: Cascade)

  @@map("Product")
}

model Category {
  id        String   @id @default(uuid())
  userId    String   @default(uuid())
  name      String   @db.VarChar(100)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User      @relation(fields: [userId], references: [id], onUpdate: Cascade)
  products Product[]

  @@map("Category")
}

model VariantOption {
  id        String @id @default(uuid())
  productId String
  name      String @db.VarChar(100)

  product Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  values  VariantValue[]

  @@map("VariantOption")
}

model VariantValue {
  id       String @id @default(uuid())
  optionId String
  value    String @db.VarChar(100)

  option               VariantOption         @relation(fields: [optionId], references: [id], onDelete: Cascade)
  productVariantValues ProductVariantValue[]

  @@map("VariantValue")
}

model ProductVariant {
  id        String @id @default(uuid())
  productId String
  sku       String @db.VarChar(255)
  stock     Int
  price     Float  @db.Float()

  product Product               @relation(fields: [productId], references: [id], onDelete: Cascade)
  values  ProductVariantValue[]

  @@map("ProductVariant")
}

model ProductVariantValue {
  id        String @id @default(uuid())
  variantId String
  valueId   String

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  value   VariantValue   @relation(fields: [valueId], references: [id], onDelete: Cascade)

  @@map("ProductVariantValue")
}

model Customer {
  id              String @id @default(uuid())
  fullname        String @db.VarChar(200)
  phone           String @db.VarChar(100)
  email           String @db.VarChar(100)
  address         String @db.VarChar(1000)
  status          String @db.VarChar(50)
  tag             String @db.VarChar(50)
  integrationType String @db.VarChar(50)

  customerNote CustomerNote[]
  order        Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Customer")
}

model CustomerNote {
  id         Int    @id @default(autoincrement())
  customerId String @default(uuid())
  content    String @db.VarChar(1000)

  createdAt DateTime @default(now())
  customer  Customer @relation(fields: [customerId], references: [id], onUpdate: Cascade)
  updatedAt DateTime @updatedAt

  @@map("CustomerNote")
}

model Order {
  id          String   @id @default(uuid())
  customerId  String   @default(uuid())
  botId       String   @default(uuid())
  status      String   @db.VarChar(50)
  totalAmount Int
  createdAt   DateTime @default(now())

  transaction Transaction[]
  orderitems  OrderItem[]
  customer    Customer      @relation(fields: [customerId], references: [id], onUpdate: Cascade)
  bot         Bot           @relation(fields: [botId], references: [id], onUpdate: Cascade)

  @@map("Order")
}

model Transaction {
  id            String   @id @default(uuid())
  orderId       String   @default(uuid())
  amount        Int
  status        String   @db.VarChar(50)
  transactionId String   @db.VarChar(225)
  createdAt     DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onUpdate: Cascade)

  @@map("Transaction")
}

model OrderItem {
  id        String   @id @default(uuid())
  orderId   String   @default(uuid())
  productId String   @default(uuid())
  quantity  Int
  price     Float
  createdAt DateTime @default(now())

  order   Order   @relation(fields: [orderId], references: [id], onUpdate: Cascade)
  product Product @relation(fields: [productId], references: [id], onUpdate: Cascade)

  @@map("OrderItem")
}
